{% extends 'base.html' %}

{% block extra_css %}
<style>
/* Profile grid: left content + right fixed-width gauge panel */
.profile-grid { display: grid; grid-template-columns: 1fr 360px; gap: var(--spacing-md); align-items: start; }
.profile-right .gauge {
  position: sticky;
  top: calc(var(--top-nav-height) + var(--spacing-sm));
  background: var(--soft-blue);
  /* make box have a full border and a stronger left accent */
  padding: 72px 32px 24px; /* increased top/right padding to give more room for the gauge */
  overflow: visible; /* allow SVG stroke to extend above the box without clipping */
  border-radius: 8px;
  border: 1px solid rgba(37,99,235,0.12); /* subtle outer border */
  border-left: 6px solid var(--medium-blue); /* prominent left accent */
  box-shadow: 0 2px 6px rgba(16,24,40,0.03);
}
.gauge svg { display: block; margin: 0 auto 8px; transform: translateX(-22px); }
.gauge svg text.score-number { font-weight: 800; font-size: 44px; fill: #1a1a1a; }
.gauge-number { text-align: center; font-size: 48px; font-weight: 800; color: #1a1a1a; margin-bottom: 8px; line-height:1; }
.tier-indicator { display:inline-block; padding:6px 12px; border-radius:20px; font-weight:700; text-transform:uppercase; letter-spacing:0.6px; margin-bottom:8px; }
.tier-indicator.green { background: rgba(11,138,11,0.08); color: #0b8a0b; }
.tier-indicator.orange { background: rgba(240,173,78,0.08); color: #f0ad4e; }
.tier-indicator.red { background: rgba(244,67,54,0.08); color: #f44336; }
.components { margin-top: 8px; }
.comp-row { display:flex; align-items:center; gap:0.5rem; margin-bottom:0.5rem; }
.comp-label { width: 38%; font-size: 0.9rem; color: var(--dark-gray); text-transform: capitalize; }
.comp-bar { background:#eee; width: 45%; height:12px; border-radius:8px; overflow:hidden; }
.comp-fill { background: linear-gradient(90deg,#f44336,#ffec3d,#0b8a0b); height:100%; width:0; }
.comp-value { width: 12%; text-align:right; font-weight:700; color:var(--dark-gray); }
@media (max-width: 900px) { .profile-grid { grid-template-columns: 1fr; } .profile-right { order: -1; } .gauge svg { transform: none; max-width:100%; } }
</style>
{% endblock %}

{% block content %}
  <h1>{{ gem_name }}</h1>
  <p><strong>Mineral Group:</strong> {{ mineral_group or 'Unknown' }}</p>

  <div class="profile-grid">
    <div class="profile-left">
      <h3>Key Properties</h3>
      <ul>
        <li><strong>Mohs Hardness:</strong> {% if hardness_val and hardness_val|float > 0 %}{{ hardness_val|round(2) }}{% else %}Unknown{% endif %}</li>
        <li><strong>Typical Size:</strong> {{ typical_size or 'Unknown' }}</li>
        <li><strong>Typical Price Range:</strong> {{ typical_price or 'Unknown' }}</li>
        <li><strong>Geological Rarity:</strong> {{ rarity_label or 'Unknown' }}</li>
        <li><strong>Market Availability:</strong> {{ availability_label or 'Unknown' }}</li>
        <li><strong>Investment Appropriateness:</strong> {{ investment_label or 'Unknown' }}</li>
      </ul>

      <h4>Links</h4>
      <p>
        <a href="https://www.gemrockauctions.com/search?query={{ gem_name | urlencode }}" target="_blank" rel="noopener">Search on Gem Rock Auctions</a>
        <br>
        <a href="https://www.bestingems.com/listing/buy-gemstones-online/?filter=gemsname:{{ gem_name | urlencode }}" target="_blank" rel="noopener">Search on Best In Gems</a>
      </p>
    </div>

    <div class="profile-right">
      <h3>Investment Ranking</h3>
  <div class="gauge">
    <!-- Ranking tier (prominent) -->
    {% if tier %}
    <div class="tier-indicator {{ tier_color|default('')|lower() }}">{{ tier }}</div>
    {% endif %}
    <!-- Overall composite score shown above the gauge -->
    <div class="gauge-number">{{ composite }}</div>
    <!-- Simple semicircle gauge using SVG -->
    {% set pct = (composite or 0) %}
    {% set angle = (pct / 100.0) * 180 %}
  <svg viewBox="0 -12 200 124" width="360" height="190" aria-hidden="true" style="overflow:visible;">
          <defs>
            <linearGradient id="grad" x1="0%" x2="100%">
              <stop offset="0%" stop-color="#f44336" />
              <stop offset="50%" stop-color="#ffec3d" />
              <stop offset="100%" stop-color="#0b8a0b" />
            </linearGradient>
          </defs>
          <path d="M10 90 A90 90 0 0 1 190 90" fill="none" stroke="#eee" stroke-width="18" />
          <path d="M10 90 A90 90 0 0 1 190 90" fill="none" stroke="url(#grad)" stroke-width="18"
                stroke-dasharray="283" stroke-dashoffset="{{ 283 - (283 * (pct/100.0)) }}" stroke-linecap="round" />
          <!-- score number moved above the gauge -->
        </svg>

        <div class="components">
          <h4>Components</h4>
          {% for label, val in composite_components.items() %}
            <div class="comp-row">
              <div class="comp-label">{{ label.replace('_',' ').title() }}</div>
              <div class="comp-bar"><div class="comp-fill" style="width: {{ val }}%"></div></div>
              <div class="comp-value">{{ val }}</div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <h3>Descriptions</h3>
  <p><strong>Rarity:</strong> {{ rarity_description or 'No description available.' }}</p>
  <p><strong>Availability:</strong> {{ availability_description or 'No description available.' }}</p>
  <p><strong>Investment description:</strong> {{ investment_description or 'No description available.' }}</p>

  {% if colors %}
  <h3>Colors</h3>
  <ul class="color-list">
    {% for c in colors %}
      <li style="display:inline-block;margin-right:0.6rem;"><span style="display:inline-block;width:18px;height:18px;background:{{ c.hex or '#ccc' }};border-radius:50%;border:1px solid rgba(0,0,0,0.12);vertical-align:middle;margin-right:0.4rem;"></span>{{ c.color }}{% if c.rarity %} - {{ c.rarity }}{% endif %}</li>
    {% endfor %}
  </ul>
  {% endif %}

  <h3>How the investment ranking was calculated</h3>
  <p>The composite score is calculated as follows: (Geological Rarity * 0.25) + (Market Availability * 0.25) + (Investment Appropriateness * 0.25) + (Hardness * 0.125) + (Price * 0.125). The table above shows the composite and component values.</p>

{% endblock %}
