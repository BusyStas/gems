<aside class="sidebar" id="sidebar" role="navigation" aria-label="Main navigation">
    <div class="sidebar-header">
        <h2>{{ config.SITE_NAME }}</h2>
        <button class="menu-toggle-btn" id="menuToggle" aria-label="Toggle menu">
            ☰
        </button>
    </div>
    
    <nav class="sidebar-menu">
        <ul class="menu-list">
            {% for item in menu_items %}
            <li class="menu-item {% if item.get('submenu') %}has-submenu{% endif %}">
                {% if item.get('submenu') %}
                <a href="#" class="menu-link {% if request.path.startswith(item.url) and item.url != '/' %}active{% elif request.path == '/' and item.url == '/' %}active{% endif %}" onclick="toggleSubmenu(event, this)">
                    <span class="menu-icon">{{ item.icon }}</span>
                    <span class="menu-text">{{ item.title }}</span>
                    <span class="submenu-arrow">›</span>
                </a>
                {% else %}
                <a href="{{ item.url }}" class="menu-link {% if request.path.startswith(item.url) and item.url != '/' %}active{% elif request.path == '/' and item.url == '/' %}active{% endif %}">
                    <span class="menu-icon">{{ item.icon }}</span>
                    <span class="menu-text">{{ item.title }}</span>
                </a>
                {% endif %}
                
                {% if item.get('submenu') %}
                <ul class="submenu">
                    {% for subitem in item.submenu %}
                    <li class="submenu-item">
                        <a href="{{ subitem.url }}" class="submenu-link {% if request.path == subitem.url %}active{% endif %}">
                            {{ subitem.title }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
    </nav>
</aside>

<script>
// Toggle sidebar collapsed state
document.getElementById('menuToggle').addEventListener('click', function(e) {
    e.stopPropagation();
    document.getElementById('sidebar').classList.toggle('collapsed');
});

// Toggle submenu on click
function toggleSubmenu(event, linkElement) {
    event.preventDefault();
    event.stopPropagation();
    
    // Get the parent menu item
    const menuItem = linkElement.closest('.menu-item');
    
    // Close all other open submenus
    const allMenuItems = document.querySelectorAll('.menu-item.has-submenu');
    allMenuItems.forEach(item => {
        if (item !== menuItem) {
            item.classList.remove('open');
        }
    });
    
    // Toggle this submenu
    menuItem.classList.toggle('open');
}

// Close submenus when clicking outside
document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    if (!sidebar.contains(event.target)) {
        const allMenuItems = document.querySelectorAll('.menu-item.has-submenu');
        allMenuItems.forEach(item => {
            item.classList.remove('open');
        });
    }
});
</script>
