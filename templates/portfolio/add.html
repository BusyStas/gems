{% extends "base.html" %}

{% block title %}Add Gem Holding - {{ config.SITE_NAME }}{% endblock %}

{% block content %}
<div class="hero-section">
    <h1>➕ Add Gem to Portfolio</h1>
    <p>Add a new gemstone holding to your collection</p>
</div>

<div class="content-section">
    <div class="card" style="max-width: 700px; margin: 0 auto;">
        {% if error %}
            <div style="background: #ffcccc; border: 1px solid #cc0000; padding: 15px; margin-bottom: 20px; border-radius: 4px; color: #cc0000;">
                <strong>⚠️ Error:</strong> {{ error }}
            </div>
        {% endif %}
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div style="background: {% if category == 'error' %}#ffcccc{% else %}#ccffcc{% endif %}; border: 1px solid {% if category == 'error' %}#cc0000{% else %}#00cc00{% endif %}; padding: 15px; margin-bottom: 20px; border-radius: 4px; color: {% if category == 'error' %}#cc0000{% else %}#006600{% endif %};">
                        <strong>{% if category == 'error' %}⚠️ Error:{% else %}✅ Success:{% endif %}</strong> {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <form method="POST" action="{{ url_for('portfolio.add_gem') }}">
            <div style="margin-bottom: 1.5rem;">
                <label for="gem_search" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Gem Type: *</label>
                <input type="text" id="gem_search" placeholder="Search gem types..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem; margin-bottom: 0.5rem;">
                <select id="gem_type_id" name="gem_type_id" required size="10" style="width: 100%; padding: 0.5rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                    <option value="">-- Select Gem Type --</option>
                    {% for gem in gem_types|sort(attribute='GemTypeName') %}
                    <option value="{{ gem.GemTypeId }}">{{ gem.GemTypeName }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="parcel_size" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Quantity:</label>
                    <input type="number" id="parcel_size" name="parcel_size" min="1" value="1" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="weight_carats" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Weight (carats):</label>
                    <input type="number" id="weight_carats" name="weight_carats" step="0.01" min="0" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="purchase_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Purchase ($):</label>
                    <input type="number" id="purchase_cost" name="purchase_cost" step="0.01" min="0" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="shipping_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Shipping ($):</label>
                    <input type="number" id="shipping_cost" name="shipping_cost" step="0.01" min="0" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="insurance_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Insurance ($):</label>
                    <input type="number" id="insurance_cost" name="insurance_cost" step="0.01" min="0" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="taxes_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Taxes ($):</label>
                    <input type="number" id="taxes_cost" name="taxes_cost" step="0.01" min="0" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="gem_form" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Form:</label>
                    <input type="text" id="gem_form" name="gem_form" placeholder="Faceted, Cabochon, Rough..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="purchase_date" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Purchase Date:</label>
                    <input type="date" id="purchase_date" name="purchase_date" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label for="original_listing_url" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Original Listing URL:</label>
                <input type="url" id="original_listing_url" name="original_listing_url" placeholder="https://..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label for="notes" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Notes:</label>
                <textarea id="notes" name="notes" rows="3" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem; font-family: inherit;"></textarea>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button type="submit" style="flex: 1; background: var(--medium-blue); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer;">Add Holding</button>
                <a href="{{ url_for('portfolio.index') }}" style="flex: 1; background: var(--light-gray); color: var(--dark-gray); padding: 0.75rem 1.5rem; border-radius: 4px; text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center;">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const gemSearch = document.getElementById('gem_search');
    const gemSelect = document.getElementById('gem_type_id');
    const options = Array.from(gemSelect.options);

    gemSearch.addEventListener('input', function(e) {
        const query = e.target.value.toLowerCase();

        options.forEach(option => {
            if (option.value === '') {
                // Always show the placeholder option
                option.style.display = '';
            } else {
                const text = option.textContent.toLowerCase();
                option.style.display = text.includes(query) ? '' : 'none';
            }
        });
    });
});
</script>
{% endblock %}
