{% extends "base.html" %}

{% block title %}Edit Holding - {{ config.SITE_NAME }}{% endblock %}

{% block content %}
<div class="hero-section">
    <h1>‚úèÔ∏è Edit Gem Holding</h1>
    <p>Update your gem holding information</p>
</div>

<div class="content-section">
    <div class="card" style="max-width: 900px; margin: 0 auto;">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div style="background: {% if category == 'error' %}#ffcccc{% else %}#ccffcc{% endif %}; border: 1px solid {% if category == 'error' %}#cc0000{% else %}#00cc00{% endif %}; padding: 15px; margin-bottom: 20px; border-radius: 4px; color: {% if category == 'error' %}#cc0000{% else %}#006600{% endif %};">
                        <strong>{% if category == 'error' %}‚ö†Ô∏è Error:{% else %}‚úÖ Success:{% endif %}</strong> {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <form method="POST" action="{{ url_for('portfolio.edit_gem', asset_id=item.AssetId) }}">
            <!-- Basic Info Section -->
            <h3 style="color: var(--primary-blue); margin-bottom: 1rem; border-bottom: 2px solid var(--light-gray); padding-bottom: 0.5rem;">üíé Basic Information</h3>
            <div style="margin-bottom: 1.5rem;">
                <label for="gem_search" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Gem Type:</label>
                <input type="text" id="gem_search" placeholder="Search gem types..." style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem; margin-bottom: 0.5rem;">
                <select id="gem_type_id" name="gem_type_id" size="8" style="width: 100%; padding: 0.5rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                    {% for gem in gem_types %}
                    <option value="{{ gem.GemTypeId }}" {% if gem.GemTypeId == item.GemTypeId %}selected{% endif %}>{{ gem.GemTypeName }}</option>
                    {% endfor %}
                </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="holding_display_name" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Display Name:</label>
                    <input type="text" id="holding_display_name" name="holding_display_name" value="{{ item.HoldingDisplayName if item.HoldingDisplayName else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="parcel_size" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Quantity:</label>
                    <input type="number" id="parcel_size" name="parcel_size" min="1" value="{{ item.ParcelSize or 1 }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="weight_carats" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Weight (carats):</label>
                    <input type="number" id="weight_carats" name="weight_carats" step="0.01" min="0" value="{{ item.WeightCarats if item.WeightCarats else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
                <label for="original_listing_title" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Original Listing Title:</label>
                <input type="text" id="original_listing_title" name="original_listing_title" value="{{ item.OriginalListingTitle if item.OriginalListingTitle else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
            </div>

            <!-- Gem Characteristics Section -->
            <h3 style="color: var(--primary-blue); margin: 2rem 0 1rem 0; border-bottom: 2px solid var(--light-gray); padding-bottom: 0.5rem;">üî¨ Gem Characteristics</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="clarity" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Clarity:</label>
                    <input type="text" id="clarity" name="clarity" placeholder="VVS, VS, SI..." value="{{ item.Clarity if item.Clarity else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="color" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Color:</label>
                    <input type="text" id="color" name="color" value="{{ item.Color if item.Color else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="treatment" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Treatment:</label>
                    <input type="text" id="treatment" name="treatment" placeholder="Heated, Untreated..." value="{{ item.Treatment if item.Treatment else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="gem_form" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Form:</label>
                    <input type="text" id="gem_form" name="gem_form" placeholder="Faceted, Cabochon..." value="{{ item.GemForm if item.GemForm else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="cut_shape" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Cut/Shape:</label>
                    <input type="text" id="cut_shape" name="cut_shape" placeholder="Oval, Round..." value="{{ item.CutShape if item.CutShape else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="dimensions" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Dimensions:</label>
                    <input type="text" id="dimensions" name="dimensions" placeholder="10x8x5 mm" value="{{ item.Dimensions if item.Dimensions else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="origination_country" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Origin Country:</label>
                    <input type="text" id="origination_country" name="origination_country" value="{{ item.OriginationCountry if item.OriginationCountry else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>

            <!-- Costs Section -->
            <h3 style="color: var(--primary-blue); margin: 2rem 0 1rem 0; border-bottom: 2px solid var(--light-gray); padding-bottom: 0.5rem;">üí∞ Costs</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="purchase_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Purchase ($):</label>
                    <input type="number" id="purchase_cost" name="purchase_cost" step="0.01" min="0" value="{{ item.PurchaseCost if item.PurchaseCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="shipping_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Shipping ($):</label>
                    <input type="number" id="shipping_cost" name="shipping_cost" step="0.01" min="0" value="{{ item.ShippingCost if item.ShippingCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="insurance_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Insurance ($):</label>
                    <input type="number" id="insurance_cost" name="insurance_cost" step="0.01" min="0" value="{{ item.InsuranceCost if item.InsuranceCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="taxes_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Taxes ($):</label>
                    <input type="number" id="taxes_cost" name="taxes_cost" step="0.01" min="0" value="{{ item.TaxesCost if item.TaxesCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="upfront_tariffs_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Upfront Tariffs ($):</label>
                    <input type="number" id="upfront_tariffs_cost" name="upfront_tariffs_cost" step="0.01" min="0" value="{{ item.UpfrontTariffsCost if item.UpfrontTariffsCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="additional_tariffs_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Add'l Tariffs ($):</label>
                    <input type="number" id="additional_tariffs_cost" name="additional_tariffs_cost" step="0.01" min="0" value="{{ item.AdditionalTariffsCost if item.AdditionalTariffsCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="seller_certification_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Seller Cert ($):</label>
                    <input type="number" id="seller_certification_cost" name="seller_certification_cost" step="0.01" min="0" value="{{ item.SellerCertificationCost if item.SellerCertificationCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="total_certification_cost" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Total Cert ($):</label>
                    <input type="number" id="total_certification_cost" name="total_certification_cost" step="0.01" min="0" value="{{ item.TotalCertificationCost if item.TotalCertificationCost else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>

            <!-- Dates Section -->
            <h3 style="color: var(--primary-blue); margin: 2rem 0 1rem 0; border-bottom: 2px solid var(--light-gray); padding-bottom: 0.5rem;">üìÖ Dates</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="purchase_date" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Purchase Date:</label>
                    <input type="date" id="purchase_date" name="purchase_date" value="{{ item.PurchaseDate if item.PurchaseDate else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="shipping_date" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Shipping Date:</label>
                    <input type="date" id="shipping_date" name="shipping_date" value="{{ item.ShippingDate if item.ShippingDate else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>

            <!-- Seller/Purchase Details Section -->
            <h3 style="color: var(--primary-blue); margin: 2rem 0 1rem 0; border-bottom: 2px solid var(--light-gray); padding-bottom: 0.5rem;">üè™ Seller & Purchase Details</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="invoice_number" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Invoice Number:</label>
                    <input type="text" id="invoice_number" name="invoice_number" value="{{ item.InvoiceNumber if item.InvoiceNumber else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="product_number" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Product Number:</label>
                    <input type="text" id="product_number" name="product_number" value="{{ item.ProductNumber if item.ProductNumber else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="seller_internal_sku" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Seller SKU:</label>
                    <input type="text" id="seller_internal_sku" name="seller_internal_sku" value="{{ item.SellerInternalSKU if item.SellerInternalSKU else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label for="original_listing_url" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Original Listing URL:</label>
                <input type="url" id="original_listing_url" name="original_listing_url" value="{{ item.OriginalListingURL if item.OriginalListingURL else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="seller_platform_id" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Seller Platform ID:</label>
                    <input type="number" id="seller_platform_id" name="seller_platform_id" value="{{ item.SellerPlatformId if item.SellerPlatformId else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="seller_nick_name" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Seller Nickname:</label>
                    <input type="text" id="seller_nick_name" name="seller_nick_name" value="{{ item.SellerNickName if item.SellerNickName else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="seller_invoice_name" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Seller Invoice Name:</label>
                    <input type="text" id="seller_invoice_name" name="seller_invoice_name" value="{{ item.SellerInvoiceName if item.SellerInvoiceName else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                <div>
                    <label for="payment_method" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Payment Method:</label>
                    <input type="text" id="payment_method" name="payment_method" value="{{ item.PaymentMethod if item.PaymentMethod else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
                <div>
                    <label for="shipping_provider" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Shipping Provider:</label>
                    <input type="text" id="shipping_provider" name="shipping_provider" value="{{ item.ShippingProvider if item.ShippingProvider else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
                </div>
            </div>
            <div style="margin-bottom: 1.5rem;">
                <label for="tracking_number" style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Tracking Number:</label>
                <input type="text" id="tracking_number" name="tracking_number" value="{{ item.TrackingNumber if item.TrackingNumber else '' }}" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem;">
            </div>

            <!-- Notes Section -->
            <h3 style="color: var(--primary-blue); margin: 2rem 0 1rem 0; border-bottom: 2px solid var(--light-gray); padding-bottom: 0.5rem;">üìù Notes</h3>
            <div style="margin-bottom: 1.5rem;">
                <textarea id="notes" name="notes" rows="3" style="width: 100%; padding: 0.75rem; border: 2px solid var(--light-gray); border-radius: 4px; font-size: 1rem; font-family: inherit;">{{ item.Notes if item.Notes else '' }}</textarea>
            </div>

            <div style="display: flex; gap: 1rem;">
                <button type="submit" style="flex: 1; background: var(--medium-blue); color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer;">Save Changes</button>
                <a href="{{ url_for('portfolio.index') }}" style="flex: 1; background: var(--light-gray); color: var(--dark-gray); padding: 0.75rem 1.5rem; border-radius: 4px; text-decoration: none; text-align: center; display: flex; align-items: center; justify-content: center;">Cancel</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const gemSearch = document.getElementById('gem_search');
    const gemSelect = document.getElementById('gem_type_id');
    const options = Array.from(gemSelect.options);

    gemSearch.addEventListener('input', function(e) {
        const query = e.target.value.toLowerCase();

        options.forEach(option => {
            const text = option.textContent.toLowerCase();
            option.style.display = text.includes(query) ? '' : 'none';
        });
    });
});
</script>
{% endblock %}
